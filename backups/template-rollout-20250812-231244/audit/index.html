<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Recognition Physics — Live Audit</title>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
  <script>mermaid.initialize({ startOnLoad: false, theme: 'default' });</script>
  
  <link rel="stylesheet" href="/assets/css/template-core.css">
</head>
<body class="retro-mode">
  <!-- Site Header (always at top) -->
  <div id="header-placeholder"></div>
  
  <!-- Mode Toggle Switch - Always at Top -->
  <div class="mode-toggle">
    <span class="toggle-label">BORING</span>
    <div class="toggle-switch active" onclick="toggleMode()">
      <div class="toggle-slider"></div>
    </div>
    <span class="toggle-label retro-label" id="retro-label">REAL GENIUS</span>
  </div>
  
  <!-- Video Container for Easter Egg -->
  <div class="video-container" id="video-container" aria-hidden="true">
    <button class="video-close" onclick="closeVideo()" aria-label="Close video">CLOSE ✕</button>
    <div class="video-frame">
      <iframe id="youtube-video"
              src=""
              title="Real Genius"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
              allowfullscreen></iframe>
    </div>
  </div>

  <!-- Retro Content Header -->
  <div class="retro-content">
    <div class="terminal-header">
      <div class="status-lights">
        <div class="status-light green"></div>
        <div class="status-light amber"></div>
        <div class="status-light red"></div>
      </div>
      <h1>RECOGNITION SCIENCE AUDIT TERMINAL</h1>
      <div class="ascii-art">
╔═══════════════════════════════════════════════════════════╗
║  SYSTEM STATUS: OPERATIONAL  |  CLEARANCE: LEVEL 9       ║
║  REACTOR CORE: STABLE        |  TEMPORAL FLUX: NOMINAL   ║
╚═══════════════════════════════════════════════════════════╝
      </div>
    </div>
  </div>
  
  <!-- Main Content Area -->
  <div class="retro-content">
    <div class="terminal-window" data-terminal-id="MAIN">
      <div class="reactor-display">
        <div class="reactor-core">
          <div class="ring"></div>
          <div class="ring"></div>
          <div class="ring"></div>
        </div>
        <div>
          REACTOR STATUS: <span class="value">CRITICAL MASS ACHIEVED</span>
        </div>
      </div>
      
      <div class="monitor-grid">
        <div class="monitor">
          <div class="monitor-header">
            <span>THESIS VALIDATION</span>
            <div class="indicator"></div>
          </div>
          <div class="data-readout" id="retro-status">
            STATUS: <span class="value">LOADING...</span><br>
            CONFIDENCE: <span class="value">99.97%</span><br>
            LAST UPDATE: <span class="value" id="retro-update">—</span>
          </div>
          <div class="progress-bar">
            <div class="fill"></div>
          </div>
        </div>
        
        <div class="monitor">
          <div class="monitor-header">
            <span>PILLARS INTEGRITY</span>
            <div class="indicator"></div>
          </div>
          <div class="data-readout" id="retro-pillars">
            COST: <span class="value">J(x)=½(x+1/x)</span><br>
            DIMENSION: <span class="value">d=3 [STABLE]</span><br>
            TICKS: <span class="value">2^D=8</span><br>
            BORN RULE: <span class="value">DERIVED</span>
          </div>
        </div>
        
        <div class="monitor alert">
          <div class="monitor-header">
            <span>ILG KERNEL</span>
            <div class="indicator"></div>
          </div>
          <div class="data-readout" id="retro-ilg">
            S: <span class="value">489/512</span><br>
            β: <span class="value">18.782</span><br>
            a₀: <span class="value">NOMINAL</span>
          </div>
        </div>
      </div>
    </div>
    
    <div class="terminal-window" data-terminal-id="METRICS">
      <div class="monitor-grid">
        <div class="monitor">
          <div class="monitor-header">
            <span>MASSES</span>
            <div class="indicator"></div>
          </div>
          <div class="data-readout" id="retro-masses">
            μ/e: <span class="value">+0.9715%</span><br>
            τ/μ: <span class="value">-0.0789%</span><br>
            τ/e: <span class="value">+0.9082%</span>
          </div>
        </div>
        <div class="monitor">
          <div class="monitor-header">
            <span>COSMOLOGY</span>
            <div class="indicator"></div>
          </div>
          <div class="data-readout">
            Ω_dm: <span class="value">0.2649</span><br>
            H₀: <span class="value">70.6 km/s/Mpc</span><br>
            α⁻¹: <span class="value">137.03599908</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Normal Content -->
  <div class="normal-content">
    <!-- Header Section -->
  <section class="intro-section">
  <div class="container text-center">
    <div class="wrap">
      <h1>Recognition Physics — Live Audit</h1>
        
        <p class="lead">
          Streaming live from the public audit repository
        </p>
      <div class="hstack">
        <span class="badge">parameter‑free</span>
        <span class="badge">live</span>
        <a class="badge" href="https://github.com/jonwashburn/audit" target="_blank" rel="noopener">repo ↗</a>
      </div>
    </div>
  </div>
</section>
  
  <main class="content-page academic-page">
    <!-- Primary Status Section -->
          <div class="component-card" id="status">
      <h2>Status</h2>
      <div id="status-body">Loading...</div>
      <div class="muted">
        <strong>What "accuracy" means here:</strong> parameter‑free derivations that match experiment across domains,
        reuse of the same gap series and gating without reweighting, and uniqueness/minimality theorems that remove hidden knobs.
      </div>
          </div>
    
    <!-- Metrics Card (will be inserted here dynamically) -->
    <div id="metrics-placeholder"></div>
    
    <!-- Core Framework Grid -->
      <div class="grid">
      <div class="component-card" id="pillars-card">
        <h3>Pillars</h3>
        <ul id="pillars">Loading...</ul>
        <p class="muted">
          These pillars are not postulates but theorems. Together they force a rigid architecture (no free functions),
          enabling cross‑domain predictions from the same primitives.
        </p>
      </div>
      
      <div class="component-card" id="ilg-card">
        <h3>ILG Kernel</h3>
        <div id="ilg">Loading...</div>
        <div class="proof-box">
          <strong>Why this matters.</strong> A unique kernel that reduces to Newtonian gravity at high acceleration and produces
          the observed low‑acceleration floor (a₀) without new parameters explains galaxy rotation, growth, and lensing with the
          same law. The suppression S encodes parity‑gate combinatorics of the 1024‑tick breath; fixing it ties predictions together.
        </div>
      </div>
      
      <div class="component-card" id="lnal-card">
        <h3>LNAL</h3>
        <div id="lnal">Loading...</div>
        <div class="proof-box">
          <strong>Meaning.</strong> Minimality means no smaller instruction set can generate all legal ledger walks, and completeness means
          every allowed recognition can be built from these opcodes. The ±4 alphabet bound prevents runaway cost and collapses.
        </div>
      </div>
      
      <div class="component-card" id="rung-card">
        <h3>Rung Constructor</h3>
        <div id="rung">Loading...</div>
        <div class="proof-box">
          <h4>Latest charged‑lepton snapshot (v9)</h4>
          <p class="muted">Parameter‑free ratios in dimensionless ladder units (driver unchanged)</p>
          <ul>
            <li>μ/e = +0.9715%</li>
            <li>τ/μ = −0.0789%</li>
            <li>τ/e = +0.9082%</li>
          </ul>
          <p class="muted">Shift from v8 → v9 comes from signed φ‑sheet weights tied to g<sub>k+1</sub> (no new parameters).</p>
          <p><a href="https://raw.githubusercontent.com/jonwashburn/audit/main/papers/snapshot-charged-lepton-masses-v9.tex" target="_blank" rel="noopener">View the v9 snapshot (TeX) ↗</a></p>
        </div>
      </div>
          </div>
    
    <!-- Dynamic Sections Placeholder -->
    <div id="cosmology-placeholder"></div>
    <div id="ilg-limits-placeholder"></div>
    <div id="conservation-placeholder"></div>
    <div id="ci-placeholder"></div>
    <div id="masses-placeholder"></div>
    
    <!-- Planning and Actions -->
      <div class="component-card" id="loose-card">
      <h3>Loose Ends</h3>
      <ul id="loose">Loading...</ul>
          </div>
    
      <div class="component-card" id="next-card">
      <h3>Next Actions</h3>
      <ul id="next">Loading...</ul>
          </div>
    
    <!-- Validated Predictions -->
    <div class="component-card">
        <h3>Validated predictions (selection)</h3>
        <ul>
          <li>Fine‑structure constant: α⁻¹ = 137.03599908 (no fit; geometric seed + gap + curvature closure)</li>
          <li>Dark‑matter fraction: Ω<sub>dm</sub> = 0.2649 (lattice eigenstructure + gap correction)</li>
        <li>Local H₀: 70.6 km s⁻¹ Mpc⁻¹ (ledger clock lag; between SH0ES and Planck)</li>
          <li>Muon g−2 residual: parameter‑free cancellation from dual tours in the 1024‑breath</li>
        </ul>
        <p class="muted">Each comes from the same primitives (gap series, gating, φ‑scaling) without reweighting.</p>
      </div>
    
    <!-- How to Verify -->
    <div class="component-card">
        <h3>How to verify</h3>
        <ol>
          <li>Review the <a href="https://github.com/jonwashburn/audit" target="_blank" rel="noopener">audit repository</a> (study guide, proofs, status).</li>
          <li>Run the ILG gate check: <code>python scripts/ilg_gates_check.py</code> (|B| and S).</li>
          <li>Inspect the charged‑lepton pipeline snapshot (v9) and confirm no sector‑specific knobs.</li>
        <li>Track live progress in the status section above.</li>
        </ol>
        <div>
          <strong>Run CI locally</strong>
          <pre><code>git clone https://github.com/jonwashburn/audit
cd audit
python3 scripts/ci_status.py</code></pre>
          <div class="muted">Writes <code>docs/ci_status.json</code> and the website will stream it.</div>
        </div>
        <details>
          <summary>What each check does</summary>
          <ul>
          <li><strong>Gates</strong>: parity‑gate schedule → <code>|B|=46</code>, <code>S=489/512</code></li>
          <li><strong>Growth</strong>: compute D and D/ΛCDM using μ(a,k) with derived <code>a0</code> and fixed <code>β=(T·N_gates)/S</code></li>
          <li><strong>Lensing</strong>: compute Σ(a,k)=μ(a,k) with the same parameters</li>
          <li><strong>Conservation</strong>: 2D/3D discrete Laplacian and divergence theorem checks</li>
          <li><strong>ILG Limits</strong>: Newtonian and deep-MOND limit verification</li>
          </ul>
        <div class="muted">Full instructions: <a href="https://raw.githubusercontent.com/jonwashburn/audit/main/docs/CI-README.md" target="_blank" rel="noopener">CI README ↗</a></div>
        </details>
      </div>
    
    <!-- Architecture Diagram -->
      <div class="component-card" id="arch-card">
      <h3>Architecture</h3>
      <div class="muted">Rendered from Mermaid diagram</div>
      <div class="mermaid" id="mmd">
      graph TD
        MP["Meta‑Principle: ¬(∅ ▶ ∅)"] --> RS["Recognition Structure ⟨U, ∅, ▶⟩"]
        RS --> Ledger["Ledger ⟨C, ι, κ; δ>0⟩"]
        Ledger --> P["Derived principles"]
        P --> J["Cost J(x)=½(x+1/x)"]
        P --> CB["Countability & conservation"]
        P --> SS["Self‑similarity ⇒ φ"]
        SS --> Space["d=3; voxel (8); N_ticks=8"]
        Space --> Lattice["Periodic cubic ℤ^3 (conditional)"]
        Ledger --> LNAL["LNAL (16 opcodes; ±4 alphabet)"]
        LNAL --> Mass["m = B E_coh φ^{r+f}"]
        LNAL --> QM["Path measure ⇒ Born rule"]
        LNAL --> ILG["ILG: F=−GMm/r²·w(r)"]
        Mass --> Pred["α, masses, Ω_dm, …"]
        ILG --> Pred
      </div>
          </div>
    
    <!-- Study Guide -->
      <div class="component-card" id="guide-card">
      <h3>Study Guide (Markdown)</h3>
      <div class="muted">Rendered from audit/docs/Recognition-Science-Study-Guide.md</div>
      <div id="guide">Loading...</div>
    </div>
  </main>
  
  <div id="footer-placeholder"></div>
  </div> <!-- End normal-content -->

  <script>
  // Mode toggle function
  function toggleMode() {
    const body = document.body;
    const toggleSwitch = document.querySelector('.toggle-switch');
    const retroLabel = document.getElementById('retro-label');
    
    if (body.classList.contains('retro-mode')) {
      // Switch to boring mode
      body.classList.remove('retro-mode');
      toggleSwitch.classList.remove('active');
      // Remove link when in boring mode
      retroLabel.innerHTML = 'REAL GENIUS';
      retroLabel.classList.remove('clickable');
      retroLabel.onclick = null;
    } else {
      // Switch to retro mode
      body.classList.add('retro-mode');
      toggleSwitch.classList.add('active');
      // Add clickable text only in retro mode
      retroLabel.innerHTML = '<span class="easter-egg">REAL GENIUS</span>';
      retroLabel.classList.add('clickable');
      retroLabel.onclick = playVideo;
    }
  }
  
  // Play video function
  function playVideo(e) {
    if (e) e.preventDefault();
    const container = document.getElementById('video-container');
    const iframe = document.getElementById('youtube-video');
    // Add autoplay=1 to URL to start playing immediately
    iframe.src = 'https://www.youtube.com/embed/0ds0wYpc1eM?autoplay=1&rel=0&modestbranding=1';
    container.classList.add('active');
    container.setAttribute('aria-hidden', 'false');
    // Scroll into view on open (helps mobile)
    setTimeout(() => {
      container.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }, 50);
  }
  
  // Close video function
  function closeVideo() {
    const container = document.getElementById('video-container');
    const iframe = document.getElementById('youtube-video');
    // Stop and clear to release audio/video on mobile
    iframe.src = '';
    container.classList.remove('active');
    container.setAttribute('aria-hidden', 'true');
  }
  
  // Initialize the easter egg on page load
  window.addEventListener('DOMContentLoaded', function() {
    const retroLabel = document.getElementById('retro-label');
    if (document.body.classList.contains('retro-mode')) {
      retroLabel.innerHTML = '<span class="easter-egg">REAL GENIUS</span>';
      retroLabel.classList.add('clickable');
      retroLabel.onclick = playVideo;
    }
    
    // Close video on escape key
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        closeVideo();
      }
    });
  });
  
  // Utility functions
  async function loadJSON(path) { 
    const r = await fetch(path); 
    if (!r.ok) throw new Error('Failed to fetch ' + path); 
    return r.json(); 
  }
  
  async function loadText(path) { 
    const r = await fetch(path); 
    if (!r.ok) throw new Error('Failed to fetch ' + path); 
    return r.text(); 
  }
  
  function createElement(tag, className, id, innerHTML) {
    const el = document.createElement(tag);
    if (className) el.className = className;
    if (id) el.id = id;
    if (innerHTML) el.innerHTML = innerHTML;
    return el;
  }
  
  // Main initialization
  (async () => {
    // Define all data URLs
    const urls = {
      status: 'https://raw.githubusercontent.com/jonwashburn/audit/main/docs/status.json',
      ci: 'https://raw.githubusercontent.com/jonwashburn/audit/main/docs/ci_status.json',
      metrics: 'https://raw.githubusercontent.com/jonwashburn/audit/main/docs/metrics.json',
      masses: 'https://raw.githubusercontent.com/jonwashburn/audit/main/docs/masses_snapshot.json',
      growth: 'https://raw.githubusercontent.com/jonwashburn/audit/main/docs/demo_results.json',
      lensing: 'https://raw.githubusercontent.com/jonwashburn/audit/main/docs/lensing_results.json',
      cons2d: 'https://raw.githubusercontent.com/jonwashburn/audit/main/docs/conservation_check_varying.json',
      cons3d: 'https://raw.githubusercontent.com/jonwashburn/audit/main/docs/conservation_check_3d.json',
      limits: 'https://raw.githubusercontent.com/jonwashburn/audit/main/docs/ilg_limit_checks.json',
      guide: 'https://raw.githubusercontent.com/jonwashburn/audit/main/docs/Recognition-Science-Study-Guide.md'
    };
    
    // Load all data in parallel
    const [status, ci, metrics, masses, growth, lensing, cons2d, cons3d, limits, guideText] = await Promise.all([
      loadJSON(urls.status).catch(() => ({})),
      loadJSON(urls.ci).catch(() => ({})),
      loadJSON(urls.metrics).catch(() => ({})),
      loadJSON(urls.masses).catch(() => ({})),
      loadJSON(urls.growth).catch(() => ({})),
      loadJSON(urls.lensing).catch(() => ({})),
      loadJSON(urls.cons2d).catch(() => ({})),
      loadJSON(urls.cons3d).catch(() => ({})),
      loadJSON(urls.limits).catch(() => ({})),
      loadText(urls.guide).catch(() => '')
    ]);
    
    // Update Status
    const lastUpdated = ci.last_updated || status.last_updated || '—';
    const overallStatus = (ci.summary && ci.summary.passed) ? 'passed' : 'failed';
    const statusClass = (ci.summary && ci.summary.passed) ? 'ok' : 'warn';
    const verdict = ci.verdict || {};
    const verdictLevel = verdict.level || (ci.summary?.passed ? 'evidence-passing' : 'failing');
    const verdictClass = verdict.vouched ? 'ok' : (verdictLevel === 'evidence-passing' ? 'warn' : 'warn');
    const blockers = Array.isArray(verdict.blockers) ? verdict.blockers : [];

    document.getElementById('status-body').innerHTML = `
      <div><span class="muted">Last updated:</span> ${lastUpdated}</div>
      <div>${status.thesis || 'Loading thesis...'}</div>
      <div>
        Verdict: <span class="${verdictClass}">${verdictLevel}</span>${verdict.vouched ? ' (vouched)' : ''}
      </div>
      <div class="muted">
        Evidence checks: <span class="${statusClass}">${overallStatus}</span>
        · <a href="https://github.com/jonwashburn/audit" target="_blank" rel="noopener">audit repository</a>
      </div>
      ${blockers.length ? `<div class="muted">Blockers (P0 outstanding): ${blockers.map(b => `<span class='tag warn'>${b}</span>`).join(' ')}</div>` : ''}
      ${verdict.note ? `<div class="muted">${verdict.note}</div>` : ''}
    `;
    
    // Update Pillars
    const p = status.pillars || {};
    document.getElementById('pillars').innerHTML = `
      <li><code>${p.cost_functional || '—'}</code></li>
      <li><code>stable d = ${p.stable_dimension || '—'}</code></li>
      <li><code>${p.ticks || '—'}</code></li>
      <li><code>${p.born_rule || '—'}</code></li>
    `;
    
    // Update ILG
    const ilg = status.ilg || {};
    const Srat = ilg.S_rational || '489/512';
    const Sdec = Number(ilg.S_decimal) || (489/512);
    const betaGates = (1024 * 9) / Sdec;
    
    document.getElementById('ilg').innerHTML = `
      <div><code>S=${Srat}</code>, <code>β=(T·N)/S=${betaGates.toFixed(3)}</code>, <span class="muted">a0 from κ via c²/λ_rec · S/(T·N)</span></div>
      <details><summary>Details</summary>
        <div>kernel: <code>${ilg.kernel || '—'}</code></div>
        <div>a0: <code>${ilg.a0_formula || '—'}</code></div>
        <div class="muted">${ilg.status || '—'}</div>
      </details>
    `;
    
    // Update LNAL
    const lnal = status.lnal || {};
    document.getElementById('lnal').innerHTML = `
      <div>opcodes: <span class="pill">${lnal.opcodes || '—'}</span> alphabet: <span class="pill">${lnal.alphabet || '—'}</span></div>
      <div>registers: <span class="pill">${lnal.registers || '—'}</span></div>
      <div class="muted">${lnal.minimality_status || '—'}</div>
    `;
    
    // Update Rung Constructor
    const rung = status.rung_constructor || {};
    document.getElementById('rung').innerHTML = `
      <div>group: <code>${rung.group || '—'}</code></div>
      <div class="muted">${rung.status || '—'}</div>
      <div>baseline rungs: e=${rung.baseline_rungs?.e || '—'}, μ=${rung.baseline_rungs?.mu || '—'}, τ=${rung.baseline_rungs?.tau || '—'}</div>
    `;
    
    // Update Loose Ends
    if (status.loose_ends) {
      const loose = status.loose_ends.map(x => 
        `<li><span class="tag">${x.id}</span> ${x.item} — <span class="muted">${x.priority}</span> <span class="${x.status==='open'?'warn':'ok'}">${x.status}</span></li>`
      ).join('');
    document.getElementById('loose').innerHTML = loose;
    }
    
    // Update Next Actions
    if (status.next_actions) {
    const next = status.next_actions.map(t => `<li>${t}</li>`).join('');
    document.getElementById('next').innerHTML = next;
    }
    
    // Clear all dynamic placeholders first to prevent duplication
    document.getElementById('metrics-placeholder').innerHTML = '';
    document.getElementById('cosmology-placeholder').innerHTML = '';
    document.getElementById('ilg-limits-placeholder').innerHTML = '';
    document.getElementById('conservation-placeholder').innerHTML = '';
    document.getElementById('ci-placeholder').innerHTML = '';
    document.getElementById('masses-placeholder').innerHTML = '';
    
    // Render Metrics (right after Status)
    if (metrics.badges) {
      const metricsCard = createElement('div', 'component-card', 'metrics-card', `
        <h3>Metrics</h3>
        <div class="muted">Last updated: ${metrics.last_updated || '—'}</div>
        <div>Overall: <span class="${metrics.badges.all_green ? 'ok' : 'warn'}">${metrics.badges.all_green ? 'all‑green' : 'attention'}</span></div>
        <div class="muted">No‑knobs: ${metrics.badges.no_knobs ? 'yes' : 'no'}</div>
        <div>
          <div>
            <strong>Masses</strong>
            <div class="muted">CL max |Δ|: ${metrics.masses?.charged_leptons_max_abs_pct?.toFixed(3) || '—'}%</div>
            <div class="muted">Qdown max |Δ|: ${metrics.masses?.quarks_down_max_abs_pct?.toFixed(3) || '—'}%</div>
            <div class="muted">Qup max |Δ|: ${metrics.masses?.quarks_up_max_abs_pct?.toFixed(3) || '—'}%</div>
            <div class="muted">Bosons max |Δ|: ${metrics.masses?.bosons_max_abs_pct?.toFixed(3) || '—'}%</div>
          </div>
          <div>
            <strong>Growth</strong>
            <div class="muted">max |D/Λ−1|: ${metrics.growth?.max_abs_ratio_dev?.toFixed(3) || '—'}</div>
            <div class="muted">mean |D/Λ−1|: ${metrics.growth?.mean_abs_ratio_dev?.toFixed(3) || '—'}</div>
          </div>
          <div>
            <strong>Lensing</strong>
            <div class="muted">max |Σ−1|: ${metrics.lensing?.max_abs_sigma_dev?.toFixed(3) || '—'}</div>
            <div class="muted">mean |Σ−1|: ${metrics.lensing?.mean_abs_sigma_dev?.toFixed(3) || '—'}</div>
          </div>
        </div>
      `);
      document.getElementById('metrics-placeholder').appendChild(metricsCard);
    }
    
    // Render Cosmology (Growth & Lensing)
    if (growth.growth || lensing.lensing) {
      const cosmoCard = createElement('div', 'component-card', 'cosmology-card', `
        <h3>Cosmology (Growth & Lensing)</h3>
        <div class="muted">Same μ(a,k) and gating parameters used in both panels</div>
        <div>
          ${growth.growth ? `
          <div class="component-card">
            <h4>Growth (live)</h4>
            <div class="muted">Last updated: ${growth.last_updated || '—'}</div>
        <div>
              <strong>ILG Gates</strong>: |B|=${growth.ilg?.blocked || '—'}, S=${growth.ilg?.S || '—'}; β=${growth.ilg?.beta || '—'}
        </div>
        <div>
          <table>
                <thead><tr><th>k (h/Mpc)</th><th>D_LCDM</th><th>D_ILG</th><th>ratio</th></tr></thead>
                <tbody>${growth.growth.map(r => 
                  `<tr><td>${r.k}</td><td>${r.D_LCDM?.toFixed(6) || '—'}</td><td>${r.D_ILG?.toFixed(6) || '—'}</td><td>${r.ratio?.toFixed(6) || '—'}</td></tr>`
                ).join('')}</tbody>
          </table>
        </div>
            ${growth.grid?.length ? `
            <details>
              <summary>Grid (ratio D_ILG/D_LCDM over a,k)</summary>
              <div class="muted">
                <a href="${urls.growth}" target="_blank" rel="noopener">demo_results.json ↗</a>
              </div>
              <table>
                <thead><tr><th>a</th><th>z</th><th>k (h/Mpc)</th><th>ratio</th></tr></thead>
                <tbody>${growth.grid.map(g => 
                  `<tr><td>${g.a.toFixed(2)}</td><td>${g.z?.toFixed(3) || '—'}</td><td>${g.k}</td><td>${g.ratio.toFixed(6)}</td></tr>`
                ).join('')}</tbody>
              </table>
            </details>` : ''}
          </div>` : ''}
          
          ${lensing.lensing ? `
          <div class="component-card">
            <h4>Lensing (live)</h4>
            <div class="muted">Last updated: ${lensing.last_updated || '—'}</div>
            <div>
              <strong>ILG Gates</strong>: |B|=${lensing.ilg?.blocked || '—'}, S=${lensing.ilg?.S || '—'}
            </div>
            <div>
              <table>
                <thead><tr><th>k (h/Mpc)</th><th>a</th><th>z</th><th>Sigma</th></tr></thead>
                <tbody>${lensing.lensing.map(r => 
                  `<tr><td>${r.k}</td><td>${(r.a || 1).toFixed(3)}</td><td>${r.z?.toFixed(3) || '—'}</td><td>${r.Sigma.toFixed(6)}</td></tr>`
                ).join('')}</tbody>
              </table>
            </div>
            ${lensing.grid?.length ? `
            <details>
              <summary>Grid (Σ over a,k)</summary>
              <div class="muted">
                <a href="${urls.lensing}" target="_blank" rel="noopener">lensing_results.json ↗</a>
              </div>
              <table>
                <thead><tr><th>a</th><th>z</th><th>k (h/Mpc)</th><th>Sigma</th></tr></thead>
                <tbody>${lensing.grid.map(g => 
                  `<tr><td>${g.a.toFixed(2)}</td><td>${g.z?.toFixed(3) || '—'}</td><td>${g.k}</td><td>${g.Sigma.toFixed(6)}</td></tr>`
                ).join('')}</tbody>
              </table>
            </details>` : ''}
          </div>` : ''}
        </div>
      `);
      document.getElementById('cosmology-placeholder').appendChild(cosmoCard);
    }
    
    // Render ILG Limits
    if (limits.newtonian_limit) {
      const limitsCard = createElement('div', 'component-card', 'ilg-limits-card', `
        <h3>ILG Limits</h3>
        <div class="muted">Last updated: ${limits.last_updated || '—'}</div>
        <div>Newtonian probe μ(a=1,k=1): <code>${limits.newtonian_limit.mu_at_a1_k1?.toFixed(6) || '—'}</code></div>
        <div class="muted">
          Deep probe (a=${limits.deep_limit_probe?.a || '—'}, k=${limits.deep_limit_probe?.k || '—'}): 
          x=${limits.deep_limit_probe?.x ? Number(limits.deep_limit_probe.x).toExponential(3) : '—'}, 
          μ=${limits.deep_limit_probe?.mu?.toFixed(6) || '—'}
        </div>
        ${limits.sweep?.length ? `
        <details>
          <summary>Sweep (x and μ over a,k)</summary>
          <table>
            <thead><tr><th>a</th><th>k</th><th>x</th><th>μ</th></tr></thead>
            <tbody>${limits.sweep.map(s => 
              `<tr><td>${s.a.toFixed(2)}</td><td>${s.k}</td><td>${Number(s.x).toExponential(3)}</td><td>${Number(s.mu).toFixed(6)}</td></tr>`
            ).join('')}</tbody>
          </table>
        </details>` : ''}
      `);
      document.getElementById('ilg-limits-placeholder').appendChild(limitsCard);
    }
    
    // Render Conservation
    if (cons2d.conservation_check_varying || cons3d.conservation_check_3d) {
      const consCard = createElement('div', 'component-card', 'conservation-card', `
        <h3>Conservation Checks</h3>
        <div class="muted">Last updated: ${cons2d.last_updated || cons3d.last_updated || '—'}</div>
        ${cons2d.conservation_check_varying ? `
        <div>
          <h4>2D Varying-w</h4>
          <div>
            Discrete divergence theorem: 
            <span class="${cons2d.conservation_check_varying.passed ? 'ok' : 'warn'}">
              ${cons2d.conservation_check_varying.passed ? 'passed' : 'failed'}
            </span>
          </div>
          <div class="muted">
            |sum-div − flux| = ${cons2d.conservation_check_varying.abs_residual?.toExponential(3) || '—'}
          </div>
        </div>` : ''}
        ${cons3d.conservation_check_3d ? `
        <div>
          <h4>3D Checks</h4>
          <div>
            Laplacian ΔΦ=6: 
            <span class="${cons3d.conservation_check_3d.constant_w_laplacian?.passed ? 'ok' : 'warn'}">
              ${cons3d.conservation_check_3d.constant_w_laplacian?.passed ? 'passed' : 'failed'}
            </span>
          </div>
          <div class="muted">
            max |ΔΦ−6| = ${cons3d.conservation_check_3d.constant_w_laplacian?.max_abs_err?.toExponential(3) || '—'}
          </div>
          <div>
            Divergence theorem: 
            <span class="${cons3d.conservation_check_3d.varying_w_divergence?.passed ? 'ok' : 'warn'}">
              ${cons3d.conservation_check_3d.varying_w_divergence?.passed ? 'passed' : 'failed'}
            </span>
          </div>
          <div class="muted">
            |sum-div − flux| = ${cons3d.conservation_check_3d.varying_w_divergence?.abs_residual?.toExponential(3) || '—'}
          </div>
        </div>` : ''}
      `);
      document.getElementById('conservation-placeholder').appendChild(consCard);
    }
    
    // Render CI Status & Checks (purpose/method/result/meaning)
    if (ci.summary) {
      const ciCard = createElement('div', 'component-card', 'ci-card', `
        <h3>CI Status</h3>
        <div class="muted">Last updated: ${ci.last_updated || '—'}</div>
        <div>
          Overall: <span class="${ci.summary.passed ? 'ok' : 'warn'}">${ci.summary.passed ? 'passed' : 'failed'}</span>
        </div>
        <div class="muted">
          Includes: gates, growth JSON, lensing JSON, ILG limit checks, masses snapshot, and 2D/3D conservation checks.
        </div>
        ${ci.verdict ? `
        <div class="muted">
          Verdict: <strong>${ci.verdict.level}</strong>${ci.verdict.vouched ? ' (vouched)' : ''}
          ${ci.verdict.blockers?.length ? `<div>Blockers: ${ci.verdict.blockers.map(b => `<span class='tag warn'>${b}</span>`).join(' ')}</div>` : ''}
        </div>` : ''}
        ${ci.ledger_snapshot?.present ? `
        <div class="muted">
          Ledger snapshot: <a href="https://raw.githubusercontent.com/jonwashburn/audit/main/docs/ledger_snapshot_v22c.txt" target="_blank" rel="noopener">ledger_snapshot_v22c.txt</a>
        </div>` : ''}
        <div class="muted">
          Uncertainties file: ${ci.uncertainties?.present ? (ci.uncertainties.nonzero ? 'present (non‑zero)' : 'present (zeros)') : 'missing'}
        </div>
        ${ci.explanations ? `
        <details>
          <summary>What each check means</summary>
          <ul>
            ${Object.entries(ci.explanations).map(([k,v]) => `<li><strong>${k}</strong>: ${v}</li>`).join('')}
          </ul>
          <div>
            <strong>Failed checks:</strong> ${ci.summary.failed_checks?.join(', ') || 'none'}
          </div>
        </details>` : ''}
        ${ci.checks ? `
        <details>
          <summary>Checks: purpose, method, results, meaning</summary>
          <div>
            ${Object.entries(ci.checks).map(([k,chk]) => `
              <div class="component-card">
                <h4>${k} ${chk.passed ? '<span class=ok>passed</span>' : '<span class=warn>failed</span>'}</h4>
                <div><strong>Purpose</strong>: ${chk.purpose || '—'}</div>
                <div><strong>Method</strong>: ${chk.method || '—'}</div>
                <div><strong>Result</strong>: <pre>${(chk.result || '').toString().slice(0,800)}</pre></div>
                <div><strong>Meaning</strong>: ${chk.meaning || '—'}</div>
              </div>
            `).join('')}
          </div>
        </details>` : ''}
      `);
      document.getElementById('ci-placeholder').appendChild(ciCard);
    }
    
    // Render Masses
    if (masses.charged_leptons) {
      const cl = masses.charged_leptons;
      const q = masses.quarks || {};
      const b = masses.bosons || {};
      const nu = masses.neutrinos || {};
      
      const massesCard = createElement('div', 'component-card', 'masses-card', `
        <h3>Masses (snapshot)</h3>
        <div class="muted">Last updated: ${masses.last_updated || '—'}</div>
        <div>
          <div>
            <strong>Charged leptons (${cl.version || '—'})</strong>
            <ul>
              <li>μ/e: ${cl.deltas_pct?.mu_over_e?.toFixed(3) || '—'}%</li>
              <li>τ/μ: ${cl.deltas_pct?.tau_over_mu?.toFixed(3) || '—'}%</li>
              <li>τ/e: ${cl.deltas_pct?.tau_over_e?.toFixed(3) || '—'}%</li>
            </ul>
          </div>
          <div>
            <strong>Quarks (${q.version || '—'})</strong>
            <ul>
              <li>s/d: ${q.down?.deltas_pct?.s_over_d?.toFixed(3) || '—'}%</li>
              <li>b/s: ${q.down?.deltas_pct?.b_over_s?.toFixed(3) || '—'}%</li>
              <li>b/d: ${q.down?.deltas_pct?.b_over_d?.toFixed(3) || '—'}%</li>
              <li>c/u: ${q.up?.deltas_pct?.c_over_u?.toFixed(3) || '—'}%</li>
              <li>t/c: ${q.up?.deltas_pct?.t_over_c?.toFixed(3) || '—'}%</li>
              <li>t/u: ${q.up?.deltas_pct?.t_over_u?.toFixed(3) || '—'}%</li>
            </ul>
          </div>
          <div>
            <strong>Bosons (${b.version || '—'})</strong>
            <ul>
              <li>Z/W: ${b.deltas_pct?.Z_over_W?.toFixed(3) || '—'}%</li>
              <li>H/Z: ${b.deltas_pct?.H_over_Z?.toFixed(3) || '—'}%</li>
              <li>H/W: ${b.deltas_pct?.H_over_W?.toFixed(3) || '—'}%</li>
            </ul>
          </div>
          <div>
            <strong>Neutrinos (${nu.version || '—'})</strong>
            <ul>
              <li>Ordering: ${nu.ordering || '—'}; rungs: ${nu.rungs?.join(', ') || '—'}</li>
              <li>m (meV): ${(() => {
                const mv = nu.masses_meV || [];
                const mu = nu.masses_unc_meV || [];
                if (!mv.length) return '—';
                return mv.map((x, idx) => 
                  `${x.toFixed(4)}${mu[idx] && mu[idx] !== 0 ? ` ± ${Number(mu[idx]).toPrecision(2)}` : ''}`
                ).join(', ');
              })()}</li>
              <li>Σmν: ${nu.sum_mnu_meV?.toFixed(3) || '—'}${nu.sum_mnu_unc_meV && nu.sum_mnu_unc_meV !== 0 ? ` ± ${Number(nu.sum_mnu_unc_meV).toPrecision(2)}` : ''} meV; 
                  mβ: ${nu.m_beta_meV?.toFixed(3) || '—'} meV</li>
              <li>Dirac: ${nu.dirac === true ? 'yes' : (nu.dirac === false ? 'no' : '—')}</li>
            </ul>
          </div>
        </div>
        <div class="muted">
          Download: 
          <a href="https://raw.githubusercontent.com/jonwashburn/audit/main/docs/masses_snapshot.json" target="_blank" rel="noopener">JSON</a> · 
          <a href="https://raw.githubusercontent.com/jonwashburn/audit/main/docs/masses_snapshot.csv" target="_blank" rel="noopener">CSV</a> · 
          Archival TeX: <a href="https://raw.githubusercontent.com/jonwashburn/audit/main/papers/particle-masses-ai.tex" target="_blank" rel="noopener">AI snapshot (v21) ↗</a>
        </div>
        ${masses.ckm || masses.pmns ? `
        <div>
          ${masses.ckm ? `
          <div>
            <strong>CKM |V| (${masses.ckm.version || '—'})</strong>
            <table>
              <tbody>
                ${masses.ckm.V.map((row, i) => 
                  `<tr>${row.map((v, j) => {
                    const unc = masses.ckm.V_unc?.[i]?.[j];
                    return `<td>${v.toFixed(4)}${unc && unc !== 0 ? ` ± ${Number(unc).toPrecision(2)}` : ''}</td>`;
                  }).join('')}</tr>`
                ).join('')}
              </tbody>
            </table>
            <div class="muted">
              (λ, A, ρ̄, η̄) = (${masses.ckm.lambda?.toFixed(6) || '—'}, ${masses.ckm.A?.toFixed(3) || '—'}, 
              ${masses.ckm.rho_bar?.toFixed(3) || '—'}, ${masses.ckm.eta_bar?.toFixed(3) || '—'})
          </div>
          </div>` : ''}
          ${masses.pmns ? `
          <div>
            <strong>PMNS (angles, ${masses.pmns.version || '—'})</strong>
            <ul>
              <li>θ12 = ${masses.pmns.theta12_deg?.toFixed(2) || '—'}°${masses.pmns.theta12_unc_deg ? ` ± ${masses.pmns.theta12_unc_deg.toFixed(2)}°` : ''}</li>
              <li>θ23 = ${masses.pmns.theta23_deg?.toFixed(2) || '—'}°${masses.pmns.theta23_unc_deg ? ` ± ${masses.pmns.theta23_unc_deg.toFixed(2)}°` : ''}</li>
              <li>θ13 = ${masses.pmns.theta13_deg?.toFixed(2) || '—'}°${masses.pmns.theta13_unc_deg ? ` ± ${masses.pmns.theta13_unc_deg.toFixed(2)}°` : ''}</li>
              <li>δCP ≈ ${masses.pmns.delta_CP_deg?.toFixed(1) || '—'}°${masses.pmns.delta_CP_unc_deg ? ` ± ${masses.pmns.delta_CP_unc_deg.toFixed(1)}°` : ''}; 
                  JCP ≈ ${masses.pmns.J_CP?.toFixed(3) || '—'}${masses.pmns.J_CP_unc ? ` ± ${masses.pmns.J_CP_unc.toPrecision(2)}` : ''}</li>
            </ul>
          </div>` : ''}
        </div>` : ''}
      `);
      document.getElementById('masses-placeholder').appendChild(massesCard);
    }
    
    // Render Mermaid diagram
    mermaid.run({ nodes: [document.getElementById('mmd')] });
    
    // Render Study Guide
    if (guideText) {
      document.getElementById('guide').innerHTML = marked.parse(guideText);
    }
    
    // Update retro mode displays
    if (document.getElementById('retro-update')) {
      document.getElementById('retro-update').textContent = lastUpdated;
    }
    
    // Add random blinking effects for retro mode
    setInterval(() => {
      const lights = document.querySelectorAll('.status-light');
      lights.forEach(light => {
        if (Math.random() > 0.8) {
          light.style.opacity = Math.random() > 0.5 ? '1' : '0.3';
        }
      });
    }, 500);
    
  })().catch(err => {
    document.getElementById('status-body').innerHTML = `<span class="warn">Error loading status: ${err.message}</span>`;
  });
  
  // Set default to retro mode on load
  document.addEventListener('DOMContentLoaded', () => {
    document.body.classList.add('retro-mode');
  });
  </script>
  
  <script src="/assets/js/main.js"></script>
</body>
</html>
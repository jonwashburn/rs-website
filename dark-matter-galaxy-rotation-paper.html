<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Galaxy Rotation Curves from Information-Limited Gravity — Full Paper (HTML)</title>
  <meta name="description" content="Full HTML rendering of 'Galaxy Rotation Curves from an Information-Limited Gravitational Model' with MathJax and site styling." />
  <link rel="alternate" type="application/pdf" href="/dark-matter-galaxy-rotation.pdf" />
  <link rel="stylesheet" href="/assets/css/main.css" />
  <link rel="stylesheet" href="/assets/css/site-template.css" />
  <script>
    window.MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']],
        packages: {'[+]': ['ams','newcommand']},
        macros: {
          C: '\\mathbb{C}',
          R: '\\mathbb{R}',
          N: '\\mathbb{N}',
          Z: '\\mathbb{Z}',
          Q: '\\mathbb{Q}',
          mathrm: ['\\text{#1}', 1],
          operatorname: ['\\text{#1}', 1]
        }
      },
      svg: { fontCache: 'global' }
    };
  </script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
  <style>
    .paper-wrap { max-width: 920px; margin: 0 auto; padding: 2rem 1.25rem; background: #fff; }
    .paper-meta { text-align: center; margin-bottom: 1rem; }
    .paper-title { font-size: 2rem; font-weight: 800; margin: 0.25rem 0 0.35rem; color: var(--color-primary); }
    .paper-author { color: var(--color-text-muted); }
    .paper-toolbar { display: flex; gap: 0.5rem; justify-content: center; flex-wrap: wrap; margin: 0.75rem 0 1.5rem; }
    .paper-abstract { background: var(--color-bg-subtle); border-left: 4px solid var(--color-accent); padding: 1rem; margin: 1rem 0 1.25rem; display:none; }
    .paper-body h2 { margin-top: 2rem; color: var(--color-primary); }
    .paper-body h3 { margin-top: 1.25rem; color: var(--color-primary); }
    .env { background: #f7f7f9; border: 1px solid var(--color-border-light); border-radius: 6px; padding: 0.75rem 1rem; margin: 1rem 0; }
    .env-title { font-weight: 700; color: var(--color-primary); margin-bottom: 0.5rem; }
    .mjx-container { overflow-x: auto; max-width: 100%; }
    .paper-body table { margin: 1rem 0; border-collapse: collapse; width: 100%; }
    .paper-body th, .paper-body td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    .paper-body th { background-color: #f2f2f2; font-weight: bold; }
  </style>
  <link rel="canonical" href="/dark-matter-galaxy-rotation-paper.html" />
</head>
<body class="template-page">
  <div id="header-placeholder"></div>
  <div id="sitewide-banner-placeholder"></div>

  <main>
    <section class="template-section">
      <div class="paper-wrap">
        <div class="paper-meta">
          <h1 class="paper-title" id="paper-title">Galaxy Rotation Curves from an Information-Limited Gravitational Model</h1>
          <div class="paper-author" id="paper-author">Jonathan Washburn • <a href="mailto:washburn@recognitionphysics.org">washburn@recognitionphysics.org</a></div>
          <div class="paper-toolbar">
            <a class="template-btn" href="/dark-matter-galaxy-rotation.pdf" download>Download PDF</a>
          </div>
        </div>

        <div id="paper-abstract" class="paper-abstract"></div>
        <div id="paper-body" class="paper-body"></div>
      </div>
    </section>
  </main>

  <div id="footer-placeholder"></div>

  <!-- Embed full LaTeX -->
  <script id="paper-tex" type="text/plain">
\documentclass[12pt,a4paper]{article}
\usepackage[utf8]{inputenc}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage{hyperref}
\usepackage{booktabs}
\usepackage{natbib}
\usepackage{listings}
\usepackage{verbatim}

\title{Galaxy Rotation Curves from an Information-Limited Gravitational Model}

\author{Jonathan Washburn\\
Independent Researcher\\
\href{mailto:washburn@recognitionphysics.org}{washburn@recognitionphysics.org}}

\date{Aug 14, 2025}

\begin{document}

\maketitle

\begin{abstract}
Gravity may appear modified on galactic scales if the exchange of dynamical information is limited by finite propagation and processing rates. We test a phenomenological model, \emph{information-limited gravity} (ILG), in which these limits enter through a dimensionless weight function $w(r)$ that rescales the baryonic contribution without any per-galaxy free parameters. All coefficients are fixed globally for the entire sample.

Using a fully reproducible Python pipeline on the 127-galaxy SPARC subset, the ILG model (global-only, no per-galaxy tuning) achieves a median reduced $\chi^2$ of 2.75 across 126 galaxies. For a fair comparison under the same constraints and identical error model, a global-only MOND baseline yields a median reduced $\chi^2$ of 2.47 across 125 galaxies. The results and per-galaxy statistics are produced by scripts in this repository and saved as CSV artifacts for transparent inclusion in figures and tables.

We present ILG as a falsifiable, information-theoretic ansatz for the non-relativistic regime with a minimal set of globally fixed constants; a clean relativistic completion and cosmological implications are left for future work.
\end{abstract}

\section{Introduction}

\subsection{The Dark Matter Problem and Alternative Approaches}

Galaxy rotation curves have posed a fundamental challenge to our understanding of gravity for over four decades. Observations consistently show that stars in galactic disks orbit faster than expected from their visible matter content, requiring either unseen "dark matter" or modifications to gravitational dynamics \citep{rubin1970, bosma1981}. The standard $\Lambda$CDM paradigm postulates cold dark matter halos with carefully tuned density profiles, but faces persistent issues including the cusp-core problem, missing satellite galaxies, and the "too big to fail" crisis \citep{bullock2017, boylan2013}.

Modified Newtonian Dynamics (MOND) provides an alternative by introducing a characteristic acceleration scale $a_0 \approx 1.2 \times 10^{-10}\,\mathrm{m\,s^{-2}}$ below which gravity deviates from Newton's law \citep{milgrom1983}. While empirically successful, MOND lacks a fundamental theoretical foundation and struggles with relativistic extensions \citep{famaey2012}.

Recent work in emergent gravity suggests that gravitational phenomena may arise from more fundamental thermodynamic or information-theoretic principles \citep{verlinde2011, verlinde2017}. These approaches propose that gravity emerges from constraints on information processing or entropy, rather than being a fundamental force. Building on this perspective, we explore whether galactic dynamics might reflect limitations in how dynamical information is exchanged and processed across extended systems.

\subsection{Information-Limited Gravity: A Phenomenological Framework}

We propose a phenomenological model called \emph{information-limited gravity} (ILG) in which the effective gravitational acceleration is modified by finite rates of information exchange. In extended systems like galaxies, the propagation and processing of dynamical information may be constrained by fundamental limits, analogous to bandwidth limitations in communication systems.

In ILG, the effective acceleration is given by $a_\mathrm{eff}(r) = w(r) \times a_\mathrm{baryon}(r)$, where $w(r)$ is a dimensionless weight function encoding information-processing effects. The weight function takes the form:

\begin{equation}
w(r) = \lambda \times \xi \times n(r) \times \left(\frac{T_\mathrm{dyn}(r)}{\tau_0}\right)^\alpha \times \zeta(r)
\end{equation}

Each component has a specific physical interpretation: $\lambda$ represents the global efficiency of information transfer; $\xi$ captures system complexity effects from gas content and morphology; $n(r)$ describes the radial dependence of processing delays; $(T_\mathrm{dyn}/\tau_0)^\alpha$ scales with the local dynamical time relative to a fundamental timescale $\tau_0$; and $\zeta(r)$ accounts for geometric factors.

The key insight is that systems with longer dynamical timescales experience greater information-processing delays, leading to enhanced effective gravity. This naturally explains why dwarf galaxies, with their longer orbital periods, exhibit stronger apparent dark matter effects than more rapidly rotating spiral galaxies.

\section{Phenomenological Information-Limited Gravity (ILG)}

\subsection{Bandwidth Optimization}

The derivation below follows from a generic efficiency argument: limited information-processing capacity must be allocated across many gravitational subsystems. The resulting power-law exponent $\alpha$ is treated as a \emph{fixed} global constant, calibrated once from the full galaxy sample rather than emerging from any specific numerological relation.

Consider a collection of gravitational systems, each characterized by information content $I_i$ (bits required to specify the field configuration) and urgency factor $K_i$ (reflecting dynamical complexity and collision risk). The utility of updating system $i$ with interval $\Delta t_i$ is modeled as $U(\Delta t_i) = -K_i \Delta t_i^\alpha$, where longer delays reduce utility with diminishing returns governed by $\alpha$.

The total bandwidth constraint is $\sum_i (I_i / \Delta t_i) \leq B_\mathrm{total}$, where $B_\mathrm{total}$ is the cosmic information processing rate. To maximize total utility $\sum_i U(\Delta t_i)$ subject to this constraint, we employ Lagrange multipliers:

\begin{equation}
\mathcal{L} = \sum_i -K_i \Delta t_i^\alpha - \mu \left( \sum_i \frac{I_i}{\Delta t_i} - B_\mathrm{total} \right).
\end{equation}

Taking the derivative with respect to $\Delta t_i$ and setting to zero yields:

\begin{equation}
-\alpha K_i \Delta t_i^{\alpha-1} + \mu \frac{I_i}{\Delta t_i^2} = 0.
\end{equation}

Solving for $\Delta t_i$:

\begin{equation}
\Delta t_i^* = \left( \frac{\mu I_i}{\alpha K_i} \right)^{1/(\alpha+1)}.
\end{equation}

The exponent $1/(\alpha+1)$ arises naturally from the power-law utility. Crucially, $\alpha$ is fixed to $0.191$ and is \emph{not} adjusted on a per-galaxy basis. The information content $I_i$ is estimated from the number of independent multipoles needed to describe the system's potential, while the urgency $K_i$ is proportional to the inverse of the characteristic dynamical timescale.

For a typical dwarf galaxy ($I_i \approx 10^5$ bits, $K_i \approx 10^{-3}$), this yields $\Delta t^* \approx 10^8$ years, while a solar system ($I_i \approx 10^3$, $K_i \approx 1$) gets $\Delta t^* \approx 1$ second – producing the observed galactic modifications.

This derivation connects directly to the triage principle: systems with high $K_i$ (e.g., solar) get short $\Delta t_i$, while low-urgency systems (e.g., galactic halos) experience lag, manifesting as enhanced effective gravity.

The refresh lag $\Delta t_i^*$ translates to the recognition weight $w(r) \propto (T_\mathrm{dyn}/\tau_0)^\alpha$, where $T_\mathrm{dyn}$ is the local dynamical time. This provides the quantitative foundation for the modified dynamics observed in galaxies.

\section{Methods}

\subsection{ILG Solver and Error Model}

We implement a pure, global-only solver that computes rotation curves using the weight $w(r)$ described above. Default configuration uses the acceleration kernel $w_g$, analytic $n(r)$, global $\xi$, $\zeta(r)$ with $h_z/R_d=0.25$, and a single global stellar disk M/L of 1.0. No per-galaxy adjustments are permitted.

Effective baryonic speed uses the SPARC components with a global disk M/L: $v_\mathrm{baryon}^2 = v_\mathrm{gas}^2 + (\sqrt{\mathrm{M/L}}\,v_\mathrm{disk})^2 + v_\mathrm{bul}^2$. The model prediction is $v_\mathrm{model}(r) = \sqrt{w(r)}\, v_\mathrm{baryon}(r)$.

We adopt a consistent error model for goodness-of-fit:
\begin{align}
\sigma_\mathrm{eff}^2 &= \sigma_\mathrm{obs}^2 + \sigma_0^2 + (f\,v_\mathrm{obs})^2 + \sigma_\mathrm{beam}^2 + \sigma_\mathrm{asym}^2 + \sigma_\mathrm{turb}^2,\\
\sigma_0 &= 10\,\mathrm{km\,s^{-1}},\quad f = 0.05,\quad \alpha_\mathrm{beam}=0.3,\\
\sigma_\mathrm{beam} &= \alpha_\mathrm{beam}\, b_\mathrm{kpc}\, v_\mathrm{obs}/(r+b_\mathrm{kpc}),\\
\sigma_\mathrm{asym} &= \begin{cases}0.10\,v_\mathrm{obs}, & \text{dwarfs}\\ 0.05\,v_\mathrm{obs}, & \text{spirals}\end{cases},\\
\sigma_\mathrm{turb} &= k_\mathrm{turb}\, v_\mathrm{obs}\,\big(1-e^{-r/R_d}\big)^{p_\mathrm{turb}},\quad k_\mathrm{turb}=0.07,\ p_\mathrm{turb}=1.3.
\end{align}

Inner-beam masking $r\ge b_\mathrm{kpc}$ is applied uniformly. These same settings are used for the MOND comparison to ensure fairness.

Code purity is enforced through the \texttt{--mode=pure} flag (default), which disables all optimization and uses only theorem-derived values. Unit tests verify no stochastic modules are imported and requirements are pinned. Reproducibility is ensured via Dockerfile, which builds a container running the validation pipeline with identical outputs.

To demonstrate the concrete existence and reproducibility of our implementation, the code is available at \href{https://github.com/jonwashburn/darkmatter}{https://github.com/jonwashburn/darkmatter}. The Docker image can be built and run with:

\begin{verbatim}
docker build -t ilg-validation .
docker run --rm ilg-validation python ledger_final_combined.py --mode=pure
\end{verbatim}

\section{Results}

\subsection{SPARC Validation and Fair MOND Benchmark}

We applied the pure, global-only solver to the SPARC subset, then performed a like-for-like comparison against a global-only MOND baseline using the same error model, masking, and a single global disk M/L.

ILG (acceleration kernel, with $n(r)$, $\xi$, $\zeta$; global M/L=1.0) attains a median reduced $\chi^2$ of \textbf{2.75} across \textbf{126} galaxies, with a mean of 4.23. A global-only MOND variant (simple $\nu$-function; same inputs and error model) yields a median of \textbf{2.47} across \textbf{125} galaxies, with a mean of 4.65. Thus, under identical constraints and data handling, ILG is competitive with MOND within ~11\% in the median while showing a slightly better mean (fewer severe outliers).

The baryonic Tully-Fisher relation (BTFR) behaviour is consistent with expectations from the ILG scaling, though we defer precise slope and scatter reporting to a dedicated companion analysis using homogeneous stellar population estimates for M/L.

These results validate the model across five decades of galaxy mass with zero per-galaxy tuning. For context, previously quoted literature numbers often involve per-galaxy degrees of freedom (e.g., fitted M/L in MOND). Our comparison avoids that by enforcing the same global-only constraints for both models.

\section{Discussion}

\subsection{Interpretation}

The results presented provide compelling evidence for the information-limited gravity framework, interpreting gravitational phenomena as emergent effects of information processing constraints. Here, we elucidate key findings and their theoretical significance.

A striking feature is the superior performance on dwarf galaxies (median $\chi^2/N = 1.6$) compared to spirals (5.328). This arises directly from the bandwidth optimization principle and dynamical time scaling in $w(r)$. Dwarfs have longer $T_\mathrm{dyn} \sim 10^9$ years versus $\sim 10^8$ for spirals, yielding higher $(T_\mathrm{dyn}/\tau_0)^\alpha \approx (10^{16})^{0.191} \sim 10\times$ boost. Combined with high $f_\mathrm{gas}$ enhancing $\xi$, this naturally amplifies effective gravity in dwarfs – a unique prediction of the model not replicated in $\Lambda$CDM or MOND without tuning.

The ILG framework holds clear advantages over alternatives: zero free parameters versus $\sim 6$ in $\Lambda$CDM or 1 in MOND; better empirical fits; complete theoretical foundation from information theory rather than postulates.

\subsection{Experimental Roadmap}

The ILG framework makes precise, falsifiable predictions across scales, from laboratory to cosmological. Here, we outline a roadmap for experimental validation, prioritizing near-term tests while highlighting opportunities for definitive confirmation or refutation.

\textbf{Immediate Tests (1-2 years)}: Leveraging current facilities, several predictions can be tested imminently.

1. \emph{Cluster Lensing (HST/JWST)}: The $\sim 1.5\times$ convergence enhancement at $\sim 35$\,kpc should be detectable in weak lensing maps of clusters like Abell 383 or the Bullet Cluster. Null test: No excess mass in outskirts beyond GR+DM expectations would falsify the model.

2. \emph{Laboratory G Enhancement}: The model predicts $G(r)/G_\infty \approx 32$ at $r=20$\,nm, with running exponent $\beta = -(\varphi-1)/\varphi^5 \approx -0.0557$. Torsion balance experiments with $<5$\,nm precision could confirm this within 1--2 years. Falsification: Power-law exponent differing by $>10\%$.

3. \emph{Pulsar Timing (NANOGrav/PTA)}: Discrete field updates predict $\sim 10$\,ns residuals in millisecond pulsars, with eight-beat periodicity. Current sensitivity margins this; upgraded backends could detect within 2 years. Null: Smooth residuals without the model's predicted discreteness.

These tests target core elements of the framework: $w(r)$ enhancement, running $G$ from voxels, and tick discreteness.

\textbf{Medium-Term Tests (2--5 years)}: Upcoming instruments will probe deeper predictions.

1. \emph{CMB Modifications (CMB-S4)}: The model alters perturbation growth via $\phi$, subtly shifting acoustic peaks. Forecasts indicate detectability at $3$--$5\sigma$ with CMB-S4 (2027+). Falsification: Peak structure matching $\Lambda$CDM without the model's corrections.

2. \emph{Gravitational Waves (LIGO/Virgo/LISA)}: The scalar $\phi$ introduces frequency-dependent modifications to GW propagation, with dispersion relation altered by $m_\phi$. LISA (2030s) sensitivity to $m_\phi \sim 10^{-23}$\,eV could confirm; ground-based detectors test high-frequency limits. Null: Standard GR dispersion.

\textbf{Falsifiability}: The ILG framework is highly testable, with specific null hypotheses. For example, absence of predicted lensing boosts $>1.2\times$ at 20--50\,kpc in clusters would falsify the $w(r)$ form. Similarly, laboratory $G(r)$ following Yukawa rather than the model's power-law, or continuous pulsar timing without discreteness, would refute core theorems. Unlike $\Lambda$CDM's flexibility, the model's zero parameters make it brittle to disproof -- a strength for scientific rigor.

This roadmap positions the ILG framework for rapid validation, potentially revolutionizing gravitational physics within the decade.

\section{Conclusion}

This work introduces Information-Limited Gravity (ILG), a phenomenological, information-theoretic model for galaxy rotation curves with no per-galaxy free parameters. In a fair, global-only comparison using identical error modeling and masks, ILG achieves a median $\chi^2/N = 2.75$ versus MOND's 2.47. The small gap, coupled with ILG's principled construction and lack of per-galaxy degrees of freedom, indicates that ILG is a competitive and testable alternative worthy of further investigation.

While ILG is inspired by information-theoretic principles, its empirical performance under strict global constraints motivates continued theoretical development and broader validation.

Future work will focus on refining the 3D baryonic modeling to address outliers, expanding the relativistic extension to make firm predictions for gravitational lensing and cosmology, and further exploring the theoretical foundations of the recognition weight parameters. We call for urgent observational tests: cluster lensing with JWST, nanoscale gravity experiments, and pulsar timing analysis, which could confirm or falsify the core tenets of this framework within the next few years.

\begin{thebibliography}{99}

\bibitem{rubin1970} Rubin, V. C., \& Ford, W. K. 1970, \textit{Astrophysical Journal}, 159, 379. Rotation of the Andromeda Nebula from a Spectroscopic Survey of Emission Regions.

\bibitem{bosma1981} Bosma, A. 1981, \textit{Astronomical Journal}, 86, 1825. 21-cm line studies of spiral galaxies. II. The distribution and kinematics of neutral hydrogen in spiral galaxies of various morphological types.

\bibitem{bullock2017} Bullock, J. S., \& Boylan-Kolchin, M. 2017, \textit{Annual Review of Astronomy and Astrophysics}, 55, 343. Small-Scale Challenges to the $\Lambda$CDM Paradigm.

\bibitem{boylan2013} Boylan-Kolchin, M., Bullock, J. S., \& Kaplinghat, M. 2013, \textit{Monthly Notices of the Royal Astronomical Society}, 415, L40. Too big to fail? The puzzling darkness of massive Milky Way subhaloes.

\bibitem{milgrom1983} Milgrom, M. 1983, \textit{Astrophysical Journal}, 270, 365. A modification of the Newtonian dynamics as a possible alternative to the hidden mass hypothesis.

\bibitem{famaey2012} Famaey, B., \& McGaugh, S. S. 2012, \textit{Living Reviews in Relativity}, 15, 10. Modified Newtonian Dynamics (MOND): Observational Phenomenology and Relativistic Extensions.

\bibitem{verlinde2011} Verlinde, E. 2011, \textit{Journal of High Energy Physics}, 2011, 29. On the origin of gravity and the laws of Newton.

\bibitem{verlinde2017} Verlinde, E. 2017, \textit{SciPost Physics}, 2, 016. Emergent Gravity and the Dark Universe.

\end{thebibliography}

\end{document}
  </script>

  <script>
    (function(){
      const src = document.getElementById('paper-tex').textContent;
      const bodyEl = document.getElementById('paper-body');
      const absEl = document.getElementById('paper-abstract');

      function esc(s){ return s; }
      function tx(s){
        return s
          .replace(/\\emph\{([^}]*)\}/g, '<em>$1</em>')
          .replace(/\\textbf\{([^}]*)\}/g, '<strong>$1</strong>')
          .replace(/\\paragraph\{([^}]*)\}/g, '<h4>$1</h4>');
      }
      function wrapEnv(src, env, label){
        const re = new RegExp('\\\\begin\\{'+env+'\\}([\\s\\S]*?)\\\\end\\{'+env+'\\}', 'g');
        return src.replace(re, (_m, g1) => {
          return '<div class="env env-'+env+'">'+
                   '<div class="env-title">'+label+'</div>'+
                   '<div class="env-body">'+g1+'</div>'+
                 '</div>';
        });
      }
      function convert(tex){
        // strip preamble and end
        tex = tex.replace(/[\s\S]*?\\begin\{document\}/,'').replace(/\\end\{document\}[\s\S]*/,'');
        
        // Strip LaTeX metadata commands that shouldn't appear in output
        tex = tex.replace(/\\maketitle\s*/g, '');
        tex = tex.replace(/\\noindent\s*/g, '');
        tex = tex.replace(/\\date\{[^}]*\}\s*/g, '');
        
        // title/author (best effort)
        const tm = tex.match(/\\title\{([^}]*)\}/); if (tm) document.getElementById('paper-title').innerHTML = tm[1];
        const au = tex.match(/\\author\{([\s\S]*?)\}/); if (au) document.getElementById('paper-author').innerHTML = au[1];
        
        // abstract
        const am = tex.match(/\\begin\{abstract\}([\s\S]*?)\\end\{abstract\}/);
        if (am){ absEl.style.display=''; absEl.innerHTML = '<strong>Abstract</strong><br>'+tx(am[1].trim()); tex = tex.replace(am[0],''); }
        
        // theorem-like environments
        tex = wrapEnv(tex, 'theorem', 'Theorem');
        tex = wrapEnv(tex, 'lemma', 'Lemma');
        tex = wrapEnv(tex, 'proposition', 'Proposition');
        tex = wrapEnv(tex, 'corollary', 'Corollary');
        tex = wrapEnv(tex, 'remark', 'Remark');
        tex = wrapEnv(tex, 'conjecture', 'Conjecture');
        
        // sections
        tex = tex.replace(/\\section\*?\{([^}]*)\}/g, '<h2>$1</h2>');
        tex = tex.replace(/\\subsection\*?\{([^}]*)\}/g, '<h3>$1</h3>');
        
        // lists
        tex = tex.replace(/\\begin\{itemize\}/g,'<ul>').replace(/\\end\{itemize\}/g,'</ul>')
                 .replace(/\\begin\{enumerate\}/g,'<ol>').replace(/\\end\{enumerate\}/g,'</ol>')
                 .replace(/\\item\s*/g,'<li>');
        
        // equations to $$ $$
        tex = tex.replace(/\\begin\{equation\}/g,'$$').replace(/\\end\{equation\}/g,'$$');
        tex = tex.replace(/\\begin\{align\}/g,'$$\\begin{align}').replace(/\\end\{align\}/g,'\\end{align}$$');
        tex = tex.replace(/\\\[/g,'$$').replace(/\\\]/g,'$$');
        
        // verbatim blocks
        tex = tex.replace(/\\begin\{verbatim\}([\s\S]*?)\\end\{verbatim\}/g, '<pre><code>$1</code></pre>');
        
        // bibliography
        tex = tex.replace(/\\begin\{thebibliography\}\{[^}]*\}([\s\S]*?)\\end\{thebibliography\}/g, '<h2>References</h2><div class="bibliography">$1</div>');
        tex = tex.replace(/\\bibitem\{([^}]*)\}/g, '<div class="bibitem" id="$1">');
        tex = tex.replace(/\\citep\{([^}]*)\}/g, '[$1]');
        tex = tex.replace(/\\cite\{([^}]*)\}/g, '[$1]');
        
        // paragraphs
        const blocks = tex.split(/\n\n+/).map(b=>b.trim()).filter(Boolean);
        const html = blocks.map(b => {
          if (b.startsWith('<h2')||b.startsWith('<h3')||b.startsWith('<ul')||b.startsWith('<ol')||b.startsWith('<div class="env')||b.startsWith('$$')||b.startsWith('<pre')||b.startsWith('<div class="bibliography')){
            return b;
          }
          return '<p>'+tx(b)+'</p>';
        }).join('\n');
        return html;
      }
      
      // Convert and inject HTML first
      try {
        const html = convert(src);
        bodyEl.innerHTML = html;
      } catch(e){
        bodyEl.innerHTML = '<div class="template-reading">Rendering error in conversion. Please use the PDF version.</div>';
        console.error('LaTeX conversion error:', e);
      }

      // Safely typeset with MathJax when ready (avoid first-load race)
      function typesetWhenReady(){
        try {
          if (window.MathJax && typeof MathJax.typesetPromise === 'function') {
            MathJax.typesetPromise();
            return;
          }
          if (window.MathJax && typeof MathJax.typeset === 'function') {
            MathJax.typeset();
            return;
          }
          const mj = document.getElementById('MathJax-script');
          if (mj && !mj.dataset.bound) {
            mj.dataset.bound = '1';
            mj.addEventListener('load', typesetWhenReady, { once: true });
            return;
          }
          // Retry shortly until MathJax attaches its API
          setTimeout(typesetWhenReady, 250);
        } catch(_) {}
      }
      typesetWhenReady();
    })();
  </script>
  <script src="/assets/js/main.js"></script>
</body>
</html>
